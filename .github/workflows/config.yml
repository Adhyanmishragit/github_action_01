name: Deploy Databricks Notebook

on:
  push:
    branches:
      - main  # Change this to your default branch if needed

jobs:
  terraform:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up Terraform
        uses: hashicorp/setup-terraform@v1
        with:
          terraform_version: 1.4.0  # Specify the Terraform version you want to use

      - name: Create Databricks Notebook
        run: |
          echo 'provider "databricks" {
            host  = "${{ secrets.DATABRICKS_HOST }}"
            token = "${{ secrets.DATABRICKS_TOKEN }}"
          }' > main.tf

          echo 'resource "databricks_notebook" "this" {
            path     = "/Users/your_email@example.com/Terraform/YourNotebook"
            language = "PYTHON"
            content_base64 = base64encode(file("your_notebook.py"))
          }' >> main.tf

          echo 'your_notebook_content' > your_notebook.py  # Replace with actual notebook content

          terraform init
          terraform plan -out=tfplan -input=false
          terraform apply -auto-approve tfplan
